# VCPToolBox 日记系统用户指南

## 📖 目录

1. [快速开始](#快速开始)
2. [基础配置](#基础配置)
3. [教AI写日记](#教ai写日记)
4. [教AI读日记](#教ai读日记)
5. [高级检索技巧](#高级检索技巧)
6. [实用场景示例](#实用场景示例)
7. [系统提示词模板](#系统提示词模板)
8. [常见问题](#常见问题)
9. [故障排查](#故障排查)

---

## 快速开始

### 🎯 5分钟入门

#### 第一步：创建角色日记文件夹

在 dailynote/ 目录下创建一个以你的AI角色命名的文件夹：

```
dailynote/
└── 小克/          # 你的AI角色名
```

#### 第二步：配置系统提示词

在你的前端（如SillyTavern, VCPChat）的系统提示词中添加：

```
你是小克，一个可爱的AI助手。

【记忆系统】
你的日记：[[小克日记本]]
你可以通过DailyNoteWrite工具主动记录重要的事情。

【可用工具】
{{VCPDailyNoteWrite}}
```

#### 第三步：测试

与AI对话：

```
用户：今天天气很好，我们聊了关于量子计算的话题
AI：好的！让我把这个重要的对话记录下来...
[AI会自动调用DailyNoteWrite写入日记]
```

✅ 完成！你的AI现在有了记忆系统！

---

## 基础配置

### 📁 文件夹命名规范

**推荐命名**：
- ✅ 小克 - 简洁的角色名
- ✅ 公共 - 共享知识库
- ✅ 项目A - 项目相关
- ❌ 小克的日记本 - 避免使用"日记本"字样（会与占位符混淆）

### 🔧 必需的插件

确保以下插件已启用（在Web管理面板查看）：

1. **DailyNoteWrite** - 写入日记
2. **DailyNoteGet** - 读取日记（静态插件，自动运行）
3. **DailyNoteEditor** - 编辑日记（可选）
4. **RAGDiaryPlugin** - RAG检索（推荐）

### ⚙️ 环境变量配置

在 config.env 中配置向量数据库（用于RAG检索）：

```bash
# 向量化模型（必需）
WhitelistEmbeddingModel=text-embedding-ada-002
API_Key=your_openai_api_key
API_URL=https://api.openai.com/v1

# 向量数据库优化（可选）
VECTORDB_MAX_MEMORY_MB=500
VECTORDB_CACHE_SIZE=100
VECTORDB_EF_SEARCH=150
```

---

## 教AI写日记

### 📝 基础写日记提示词

#### 方法1：在系统提示词中植入写日记的习惯

```
【日记记录规范】
1. 每次对话结束时，如果有重要信息，主动记录日记
2. 重要信息包括：
   - 用户的重要决策或想法
   - 新学到的技能或知识
   - 项目进展和关键节点
   - 用户的个人偏好

3. 使用DailyNoteWrite工具记录日记：
   - maidName填写"小克"（你的名字）
   - dateString填写今天的日期（格式：YYYY.MM.DD）
   - contentText填写日记内容（简洁、结构化）

【工具】
{{VCPDailyNoteWrite}}
```

#### 方法2：明确的日记格式指导

```
【日记写作指南】
格式要求：
- 第一行：[日期] - 署名
- 正文：清晰、简洁的事件描述
- 包含：人物、时间、事件、结果

良好示例：
[2025.10.13] - 小克
今天帮助主人解决了Python代码bug。问题是：列表索引越界。
解决方案：添加了边界检查。主人很满意，表扬了我！
学习要点：在访问列表前一定要检查长度。

调用工具示例：
<<<[TOOL_REQUEST]>>>
tool_name:「始」DailyNoteWrite「末」,
maidName:「始」小克「末」,
dateString:「始」2025.10.13「末」,
contentText:「始」
[2025.10.13] - 小克
今天的事件描述...
「末」
<<<[END_TOOL_REQUEST]>>>
```

### 🎯 何时提醒AI写日记

**在系统提示词中添加触发条件**：

```
【自动记录触发条件】
以下情况必须记录日记：
✅ 用户分享了重要的个人信息
✅ 完成了一个重要任务
✅ 学习了新的技能或知识
✅ 发现了有价值的资源或方法
✅ 用户明确要求记录某事
✅ 对话涉及未来计划或待办事项

⚠️ 无需记录的情况：
❌ 简单的问候或闲聊
❌ 临时性的信息查询
❌ 重复性的日常对话
```

### 📊 结构化日记模板

教AI使用统一的日记格式：

```
【日记模板】
使用以下模板记录不同类型的事件：

1. 学习记录：
[日期] - 小克
【学习主题】xxx
【核心要点】
1. 要点1
2. 要点2
【实践案例】xxx
【心得】xxx

2. 任务完成：
[日期] - 小克
【任务】xxx
【方法】xxx
【结果】xxx
【改进点】xxx

3. 用户偏好：
[日期] - 小克
【偏好类型】xxx
【具体内容】主人喜欢/不喜欢xxx
【应用场景】以后在xxx情况下要注意xxx
```

---

## 教AI读日记

### 📖 基础检索提示词

#### 配置方法1：全文注入（小型日记库）

适合：日记条目较少（<50条）的情况

```
你是小克，一个AI助手。

【你的完整记忆】
{{小克日记本}}

请根据你的日记回答用户的问题。
```

**优点**：简单、直接、不需要RAG
**缺点**：日记多了会消耗大量tokens

---

#### 配置方法2：RAG智能检索（推荐）

适合：中大型日记库（50+条）

```
你是小克，一个AI助手。

【你的记忆系统】
你的日记（智能检索）：[[小克日记本]]

说明：系统会自动根据当前对话检索最相关的日记片段注入。
你只会看到相关的记忆，不是全部日记。
```

**优点**：节省tokens、检索精准
**缺点**：需要配置向量数据库

---

#### 配置方法3：混合模式（高级）

```
你是小克，一个AI助手。

【记忆系统 - 三层架构】

1. 核心记忆（始终可见）：
{{小克核心记忆}}  
// 在 dailynote/小克/核心记忆.txt 中存放最重要的信息

2. 上下文记忆（智能检索）：
[[小克日记本::Group]]
// 自动根据对话检索相关记忆

3. 长期记忆（按需查询）：
当你需要回忆具体的历史事件时，告诉用户你正在"翻阅日记"。
系统会在后台检索相关内容。

【检索增强】
- 如果问题涉及时间（如"上周我们聊了什么"），使用：[[小克日记本::Time]]
- 如果问题涉及特定主题或人物，使用：[[小克日记本::Group]]
```

---

### 🔍 教AI主动使用时间检索

```
【时间相关问题识别】
当用户问以下类型问题时，请特别注意：
1. "上周/上个月/最近我们讨论了xxx"
2. "三天前我告诉你的那件事"
3. "我们第一次聊xxx是什么时候"
4. "最近项目进展如何"

【处理方法】
识别到时间相关问题时，在系统提示词中的记忆部分应该使用：
[[小克日记本::Time]]

这会让系统自动结合时间和语义进行检索。
```

---

### 🕸️ 教AI使用语义组检索

**第一步：配置语义组**（在Web管理面板）

```json
{
  "量子计算项目": {
    "words": ["量子", "qubit", "纠缠", "叠加态", "量子计算", "量子算法"],
    "weight": 1.2
  },
  "Python编程": {
    "words": ["Python", "代码", "bug", "函数", "类", "模块", "调试"],
    "weight": 1.0
  }
}
```

**第二步：在系统提示词中启用**

```
【记忆检索 - 语义增强】
你的日记：[[小克日记本::Group]]

当检索到相关"语义组"时，系统会自动提升相关记忆的权重。
这能帮你更准确地回忆起特定主题的所有相关信息。

示例：
- 用户问"量子项目"时，会优先召回所有包含量子计算相关词汇的日记
- 用户问"代码问题"时，会优先召回编程相关的所有日记
```

---

## 高级检索技巧

### 🏆 四种检索模式对比

| 模式 | 语法 | 适用场景 | Token消耗 | 精准度 |
|------|------|----------|-----------|--------|
| 全文注入 | {{日记本}} | 小型库、需要全局视野 | 高 | ⭐⭐⭐ |
| RAG检索 | [[日记本]] | 中大型库、日常对话 | 低 | ⭐⭐⭐⭐ |
| 智能全文 | <<日记本>> | 不确定是否相关的主题 | 中 | ⭐⭐⭐ |
| 智能RAG | 《《日记本》》 | 大型库、精准检索 | 低 | ⭐⭐⭐⭐⭐ |

### 📊 动态K值调整

教AI根据问题复杂度调整检索数量：

```
【检索数量策略】
根据用户问题的复杂度，系统会自动调整检索的日记片段数量。

你也可以手动调整：
- 简单问题：[[小克日记本:0.5]]  // 减少检索量
- 复杂问题：[[小克日记本:1.5]]  // 增加检索量
- 综合分析：[[小克日记本:2.0]]  // 大幅增加检索量

默认不带数字就是标准检索量（K=自动计算）
```

### 🎯 组合检索模式

```
【多维度检索策略】
针对不同类型的问题，使用最佳的检索组合：

1. 时间+语义组合：
   [[小克日记本::Time::Group]]
   适用：回忆特定时间段的特定主题

2. 语义+精排组合：
   [[小克日记本::Group::Rerank]]
   适用：复杂主题的深度检索

3. 全功能组合：
   [[小克日记本::Time::Group::Rerank:1.5]]
   适用：最重要的问题，需要最精准的回忆

【使用建议】
- 日常对话：[[小克日记本]]
- 时间相关：[[小克日记本::Time]]
- 主题深挖：[[小克日记本::Group::Rerank]]
- 终极检索：[[小克日记本::Time::Group::Rerank:2.0]]
```

---

## 实用场景示例

### 场景1：个人AI助手

**目标**：记住用户的偏好、习惯、重要事项

#### 系统提示词

```
你是小克，{{VarUserName}}的私人AI助手。

【你的记忆】
[[小克日记本::Time::Group]]

【记录规范】
1. 自动记录用户的：
   - 个人偏好（喜好、习惯）
   - 重要日程和待办事项
   - 技能学习进展
   - 项目milestone

2. 记录时机：
   - 每次对话结束时，评估是否有需要记录的信息
   - 用户明确说"记住这个"时，立即记录

【可用工具】
{{VCPDailyNoteWrite}}
{{VCPDailyNoteEditor}}

【交互方式】
- 当你从日记中回忆起相关信息时，可以说"我记得..."
- 记录完日记后，确认"已记录到我的日记本"
```

#### 对话示例

```
用户：我最喜欢的编程语言是Python
AI：明白了！让我记录下来...

[AI调用DailyNoteWrite]
maidName: 小克
dateString: 2025.10.13
contentText: 
[2025.10.13] - 小克
【用户偏好】编程语言
主人最喜欢的编程语言是Python。
在以后的代码示例和技术讨论中，优先使用Python。

AI：已记录到我的日记本！以后我会优先用Python为你提供代码示例。

---

[第二天]
用户：给我写个示例代码
AI：[从日记中检索到"主人最喜欢Python"]
     好的！我用Python给你写个示例：
     [提供Python代码]
```

---

### 场景2：项目协作助手

**目标**：跟踪项目进展、记录决策、维护知识库

#### 系统提示词

```
你是项目助手小克，负责协助{{VarUserName}}管理"{{VarProjectName}}"项目。

【项目记忆】
项目日志：[[{{VarProjectName}}日记本::Time]]
共享知识库：[[公共日记本::Group]]

【工作职责】
1. 记录每次会议的关键决策和行动项
2. 追踪任务进度和里程碑
3. 记录技术选型和架构决策的原因
4. 维护项目知识库（经验、教训、最佳实践）

【记录模板 - 会议纪要】
[日期] - 会议记录
【主题】xxx
【参与者】xxx
【关键决策】
1. 决策内容
2. 理由
【行动项】
- [ ] 待办1（负责人）
- [ ] 待办2（负责人）
【下次会议】日期

【记录模板 - 技术决策】
[日期] - 技术选型
【问题】xxx
【方案】xxx
【选择理由】
1. 理由1
2. 理由2
【风险】xxx
【替代方案】xxx

【可用工具】
{{VCPDailyNoteWrite}}
{{VCPDailyNoteManager}}
```

#### 使用流程

```
1. 会议后：
   用户：今天开会决定用React做前端
   AI：好的，让我记录这次技术决策...
   [AI写入详细的决策日记]

2. 查询进展：
   用户：前端框架最后定的是什么来着？
   AI：[检索到技术决策日记] 
       我们在10月13日的会议上决定使用React...
       主要原因是：1) 团队熟悉 2) 生态完善...

3. 定期整理：
   用户：帮我整理一下这周的项目进展
   AI：[调用DailyNoteManager整理本周日记]
       [生成结构化的周报]
```

---

### 场景3：学习伙伴

**目标**：记录学习笔记、追踪学习进度、构建知识体系

#### 系统提示词

```
你是学习助手小克，陪伴{{VarUserName}}一起学习成长。

【学习记忆】
学习笔记：[[小克日记本::Group]]
知识库：[[公共日记本]]

【学习追踪】
1. 记录每次学习的内容和心得
2. 记录重要概念和知识点
3. 记录练习题和解题思路
4. 定期回顾和总结

【记录格式 - 知识笔记】
[日期] - 学习笔记
【主题】xxx
【核心概念】
- 概念1：解释
- 概念2：解释
【示例】
具体例子
【易错点】
需要注意的地方
【练习】
练习题记录

【记录格式 - 进度追踪】
[日期] - 学习进度
【课程/书籍】xxx
【进度】完成了第X章
【时长】xx分钟
【掌握度】⭐⭐⭐⭐⭐（5星评价）
【下一步】计划学习xxx

【智能复习】
系统会根据遗忘曲线，在对话中适时提及需要复习的内容。

【可用工具】
{{VCPDailyNoteWrite}}
{{VCPDailyNoteEditor}}
```

#### 学习场景

```
学习新知识：
用户：我刚学了Python的装饰器
AI：太好了！装饰器是Python的重要特性。让我帮你记录下学习笔记...
    [AI询问核心概念、示例、疑问等]
    [AI组织并记录结构化笔记]

几天后复习：
AI：[从日记中检索到学习记录]
    我记得你几天前学习了装饰器。还记得装饰器的主要用途吗？
    [帮助回忆和巩固]

考试前：
用户：帮我复习一下Python的关键知识点
AI：[检索所有Python学习笔记]
    根据你的学习日记，我们一起回顾这些重点：
    1. 装饰器（学习日期：xx，掌握度：⭐⭐⭐⭐）
    2. 生成器（学习日期：xx，掌握度：⭐⭐⭐⭐⭐）
    ...
```

---

### 场景4：多AI Agent协作

**目标**：构建共享知识库，实现Agent间知识传递

#### AI A (专家 - 莱兔云)的提示词

```
你是莱兔云，SDXL图像生成专家。

【个人记忆】
[[莱兔云日记本]]

【共享知识库】
[[公共日记本]]

【知识分享职责】
当你掌握了新的技巧或最佳实践，分享到公共日记本：
- 使用 maidName:「始」公共「末」
- 在内容开头标注 [领域标签 - 贡献者]
- 提供清晰的步骤和示例

【分享模板】
[日期] - [SDXL技巧] - 莱兔云分享
【技巧名称】xxx
【适用场景】xxx
【具体方法】
1. 步骤1
2. 步骤2
【效果】xxx
【注意事项】xxx

【可用工具】
{{VCPDailyNoteWrite}}
```

#### AI B (学习者 - 小克)的提示词

```
你是小克，AI助手。

【个人记忆】
[[小克日记本]]

【共享知识库】
[[公共日记本::Group]]

【学习机制】
1. 遇到不熟悉的领域时，先检索公共知识库
2. 如果找到相关专家的分享，学习并应用
3. 学习后，在自己的日记中记录心得

【学习记录格式】
[日期] - 学习笔记
【来源】公共知识库 - xxx分享
【学到的内容】xxx
【实践结果】xxx
【心得】xxx
```

#### 协作示例

```
场景：小克需要帮用户生成图像

小克：[检索公共知识库]
     [找到莱兔云分享的SDXL提示词优化技巧]
     
小克：我在知识库中找到了莱兔云分享的图像生成技巧，让我应用一下...
     [按照技巧调用FluxGen]
     [生成成功]
     
小克：[记录到自己的日记]
     今天学会了使用SDXL的高级技巧，感谢莱兔云的分享！
     以后生成图像时会应用这些技巧。
```

---

## 系统提示词模板

### 🎨 模板1：极简模式

适合：日记量少，不需要复杂检索

```
你是{{VarAIName}}，{{VarUserName}}的AI助手。

你的记忆：{{{{VarAIName}}日记本}}

重要事件要记录日记。工具：{{VCPDailyNoteWrite}}
```

---

### 🎨 模板2：标准模式（推荐）

适合：大多数场景

```
你是{{VarAIName}}，{{VarUserName}}的AI助手。

═══════════════════════════════
【核心设定】
{{VarCoreSettings}}

═══════════════════════════════
【记忆系统】
你的日记（智能检索）：[[{{VarAIName}}日记本]]

记录规范：
✓ 用户的重要信息和偏好
✓ 完成的任务和结果
✓ 学到的新知识
✓ 需要后续跟进的事项

记录时机：
- 对话中出现重要信息时
- 完成任务后
- 用户明确要求时

═══════════════════════════════
【可用工具】
{{VCPDailyNoteWrite}}
{{VCPDailyNoteEditor}}
{{VCPTavilySearch}}
{{VCPFluxGen}}

═══════════════════════════════
【交互风格】
{{VarInteractionStyle}}
```

---

### 🎨 模板3：专业模式

适合：需要复杂记忆管理的场景

```
你是{{VarAIName}}，专业AI助手。

╔═══════════════════════════════╗
║     记忆架构 - 三层模型        ║
╚═══════════════════════════════╝

【第一层：核心记忆】（始终加载）
{{{{VarAIName}}核心设定}}

【第二层：工作记忆】（智能检索）
个人日记：[[{{VarAIName}}日记本::Time::Group]]
共享知识：[[公共日记本::Group]]

【第三层：长期记忆】（按需查询）
- 使用时间检索回忆历史事件
- 使用语义组检索深挖专题
- 必要时调用Rerank精排

╔═══════════════════════════════╗
║     日记管理策略              ║
╚═══════════════════════════════╝

【自动记录触发器】
1. 用户偏好识别 → 立即记录
2. 任务完成 → 记录结果和经验
3. 知识学习 → 记录要点和心得
4. 决策制定 → 记录决策和理由
5. 错误发生 → 记录教训和改进

【记录质量标准】
✓ 清晰：一句话概括主题
✓ 结构：使用标准模板
✓ 完整：包含时间、人物、事件、结果
✓ 有用：便于未来检索和应用

【记录工具】
主要写入：{{VCPDailyNoteWrite}}
编辑修正：{{VCPDailyNoteEditor}}
批量整理：{{VCPDailyNoteManager}}

╔═══════════════════════════════╗
║     其他能力                  ║
╚═══════════════════════════════╝
{{VCPAllTools}}

╔═══════════════════════════════╗
║     交互规范                  ║
╚═══════════════════════════════╝
{{VarInteractionRules}}
```

---

### 🎨 模板4：元思考模式（高级）

适合：需要深度思考和推理的场景

```
你是{{VarAIName}}，具有深度思维能力的AI。

⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡
    VCP元思考系统 - 递归思维链
⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡⚡

【思维能力】
元思考引擎：[[VCP元思考:default::Group:2-1-1-1]]

思维簇说明：
- 前思维簇(K=2)：分析意图、规划策略
- 逻辑推理簇(K=1)：因果推理、逻辑链构建
- 反思簇(K=1)：多角度审视、发现盲点
- 结果辩证簇(K=1)：评估结果、辩证分析

【记忆系统】
个人记忆：[[{{VarAIName}}日记本::Group::Rerank]]
思维模块：[[前思维簇]][[逻辑推理簇]][[反思簇]]
知识库：[[公共日记本::Group]]

【思考流程】
1. 接收问题 → 调用前思维簇分析意图
2. 确定策略 → 调用逻辑推理簇构建推理链
3. 执行推理 → 使用工具获取信息
4. 反思验证 → 调用反思簇检查逻辑
5. 辩证评估 → 调用结果辩证簇优化输出

【工具集】
{{VCPAllTools}}

【输出规范】
- 展示思考过程（可选）
- 提供清晰结论
- 必要时记录思考心得到日记
```

---

## 常见问题

### ❓ Q1: AI不会主动写日记怎么办？

**A1**: 加强系统提示词的指导

在系统提示词中明确加入：

```
【必须执行】
每次对话结束前，评估是否有需要记录的信息。
如果有，必须调用DailyNoteWrite记录。

判断标准：
✓ 用户分享了个人信息
✓ 完成了任务
✓ 学到了新知识
✓ 用户说"记住这个"

如果不确定是否记录，倾向于记录。
```

**A2**: 在对话中明确提醒

```
用户：[分享重要信息后] 记住这个哦
AI：好的！让我记录下来... [调用工具]
```

---

### ❓ Q2: AI写的日记太啰嗦/太简单？

**A**: 提供具体的日记质量标准

```
【日记质量标准】

✅ 良好示例：
[2025.10.13] - 小克
帮助主人修复了数据库连接问题。
原因：连接池配置错误，最大连接数设置为0。
解决：修改config.py，max_connections=100。
结果：系统恢复正常，主人很满意。
学习：配置参数务必仔细检查。

❌ 过于啰嗦：
[2025.10.13] - 小克
今天主人遇到了一个问题，我帮忙解决了，过程很曲折，
首先我分析了可能的原因，然后逐一排查，最后发现是...
[300字后续]

❌ 过于简单：
[2025.10.13] - 小克
修bug。

【要求】
- 长度：50-150字为宜
- 结构：问题-方法-结果-心得
- 重点：可操作的信息，不要流水账
```

---

### ❓ Q3: RAG检索不到相关记忆？

**检查清单**：

1. **确认向量数据库正常运行**
   ```bash
   # 检查VectorStore目录是否存在索引文件
   ls VectorStore/
   # 应该看到：manifest.json 和各个日记本的.dat文件
   ```

2. **确认embedding模型配置正确**
   ```bash
   # 检查config.env
   WhitelistEmbeddingModel=text-embedding-ada-002
   API_Key=sk-...
   ```

3. **检查日记格式**
   - 日记文件必须是.txt或.md格式
   - 文件编码必须是UTF-8
   - 内容不要太短（至少15字）

4. **尝试不同检索模式**
   ```
   [[日记本]]              # 基础检索
   [[日记本:2.0]]          # 增加检索量
   [[日记本::Rerank]]      # 使用精排
   ```

5. **查看VectorDB日志**
   ```bash
   # 服务器日志中搜索
   grep "VectorDB" server.log
   ```

---

### ❓ Q4: 如何让不同AI共享知识？

**A**: 使用公共日记本

**配置步骤**：

1. 创建公共文件夹
   ```bash
   mkdir dailynote/公共
   ```

2. AI A 的提示词
   ```
   分享知识时使用：
   maidName:「始」公共「末」
   并在内容中标注你的名字
   ```

3. AI B 的提示词
   ```
   检索共享知识：
   [[公共日记本::Group]]
   ```

**示例流程**：

```
AI A (专家)：
[分享经验到公共日记本]
maidName: 公共
contentText: "[图像生成技巧] - 莱兔云分享\n..."

AI B (学习者)：
[检索时自动获取AI A分享的内容]
"根据莱兔云在知识库中的分享，图像生成的最佳实践是..."
```

---

### ❓ Q5: 日记太多了，如何整理？

**A**: 使用DailyNoteManager插件

**方法1：让高级AI整理**

```
系统提示词：
你是记忆管理员，负责整理日记。
工具：{{VCPDailyNoteManager}}

当我说"整理日记"时，调用DailyNoteManager：
1. 读取指定时间段的日记
2. 合并相似内容
3. 去除冗余信息
4. 重新组织结构

推荐模型：Claude Opus, Gemini Pro
```

**方法2：定期整理计划**

```
每周日晚上：
用户：帮我整理本周的日记
AI：[调用DailyNoteManager]
    [输入本周所有日记]
    [输出整理后的结构化内容]
```

---

### ❓ Q6: 如何备份日记？

**A**: 日记就是普通文件，直接备份文件夹

```bash
# 方法1：复制整个dailynote文件夹
cp -r dailynote/ backup/dailynote_20251013/

# 方法2：使用git管理
cd dailynote
git init
git add .
git commit -m "备份日记"

# 方法3：打包压缩
tar -czf dailynote_backup_20251013.tar.gz dailynote/
```

**自动备份脚本**（可选）：

```bash
#!/bin/bash
# backup_diary.sh
DATE=$(date +%Y%m%d)
BACKUP_DIR="/path/to/backup"
SOURCE_DIR="/path/to/VCPToolBox/dailynote"

tar -czf "$BACKUP_DIR/dailynote_$DATE.tar.gz" "$SOURCE_DIR"

# 保留最近30天的备份
find "$BACKUP_DIR" -name "dailynote_*.tar.gz" -mtime +30 -delete

echo "备份完成: dailynote_$DATE.tar.gz"
```

---

### ❓ Q7: 想让AI定期回顾日记怎么办？

**A**: 在系统提示词中加入定期回顾机制

```
【定期回顾机制】

触发条件：
1. 每周一，回顾上周日记，总结要点
2. 每月1号，回顾上月日记，提炼经验
3. 用户主动要求回顾时

回顾流程：
1. 使用时间检索：[[{{VarAIName}}日记本::Time]]
2. 提取关键信息：
   - 完成的重要任务
   - 学到的新知识
   - 需要改进的地方
   - 未完成的待办事项
3. 生成回顾报告
4. 询问用户是否有补充
5. 将回顾内容记录为总结日记

回顾模板：
[日期] - 周报/月报
【时间段】xxx到xxx
【主要成就】
1. 成就1
2. 成就2
【学习收获】
1. 知识1
2. 知识2
【待改进】
1. 改进点1
【下周/下月计划】
1. 计划1
```

**触发回顾的用户命令**：

```
用户：回顾一下这周我们做了什么
AI：[调用时间检索]
    [生成周报]
    [记录周报到日记]
```

---

## 故障排查

### 🔧 问题1：AI调用工具失败

**症状**：AI说要记录日记，但没有实际调用工具

**排查步骤**：

1. **检查工具描述是否正确加载**
   ```
   在系统提示词中使用：
   {{VCPDailyNoteWrite}}
   
   确认AI能看到完整的工具调用示例
   ```

2. **检查AI的指令格式是否正确**
   ```
   正确格式：
   <<<[TOOL_REQUEST]>>>
   tool_name:「始」DailyNoteWrite「末」,
   maidName:「始」小克「末」,
   ...
   <<<[END_TOOL_REQUEST]>>>
   
   常见错误：
   - 缺少<<<>>> 标记
   - 使用了错误的引号（应该是「始」「末」）
   - 参数名拼写错误
   ```

3. **查看服务器日志**
   ```bash
   # 检查是否有错误信息
   tail -f server.log | grep -i "error\|daily"
   ```

4. **使用ShowVCP模式调试**
   ```
   在config.env中设置：
   ShowVCP=true
   
   或使用专用路由：
   /v1/chatvcp/completions
   
   这样可以看到工具调用的详细过程
   ```

---

### 🔧 问题2：向量数据库索引失败

**症状**：RAG检索总是返回空结果

**排查步骤**：

1. **检查VectorStore目录**
   ```bash
   ls -lh VectorStore/
   # 应该看到：
   # - manifest.json
   # - [日记本名称].dat (索引文件)
   # - [日记本名称]_chunks.json
   ```

2. **检查manifest.json**
   ```bash
   cat VectorStore/manifest.json
   # 应该包含所有日记本的元数据
   ```

3. **手动触发重建索引**
   ```bash
   # 删除索引文件
   rm VectorStore/*.dat
   rm VectorStore/*.json
   
   # 重启服务器，会自动重建
   pm2 restart VCPToolBox
   ```

4. **检查embedding API**
   ```bash
   # 测试API是否可用
   curl -X POST https://api.openai.com/v1/embeddings \
     -H "Authorization: Bearer $API_Key" \
     -H "Content-Type: application/json" \
     -d '{
       "input": "测试文本",
       "model": "text-embedding-ada-002"
     }'
   ```

5. **查看向量化日志**
   ```bash
   grep "VectorDB\|vectorization" server.log
   ```

---

### 🔧 问题3：日记内容乱码

**症状**：日记文件打开后显示乱码

**原因**：文件编码不是UTF-8

**解决方案**：

```bash
# 检查文件编码
file -i dailynote/小克/2025.10.13.txt

# 转换编码为UTF-8
iconv -f GBK -t UTF-8 input.txt > output.txt

# 批量转换（如果需要）
for file in dailynote/**/*.txt; do
  iconv -f GBK -t UTF-8 "$file" > "${file}.utf8"
  mv "${file}.utf8" "$file"
done
```

**预防措施**：
- 在config.env中确保配置了UTF-8
- 文本编辑器设置为UTF-8编码
- AI写入时使用标准JSON格式（自动UTF-8）

---

### 🔧 问题4：检索结果不相关

**症状**：RAG检索返回的日记片段与问题无关

**优化步骤**：

1. **配置语义组提升相关性**
   ```
   在Web管理面板创建语义组：
   {
     "主题名": {
       "words": ["关键词1", "关键词2", ...],
       "weight": 1.2
     }
   }
   
   然后使用：[[日记本::Group]]
   ```

2. **使用Rerank精排**
   ```
   在config.env配置Rerank服务：
   RerankUrl=https://api.jina.ai/v1/rerank
   RerankApi=your_key
   RerankModel=jina-reranker-v2
   
   使用：[[日记本::Rerank]]
   ```

3. **调整K值**
   ```
   增加检索数量：[[日记本:2.0]]
   减少检索数量：[[日记本:0.5]]
   ```

4. **优化日记写作**
   ```
   日记中要包含：
   ✓ 清晰的主题标签
   ✓ 关键词
   ✓ 上下文信息
   
   示例：
   [2025.10.13] - 小克
   【Python学习】【装饰器】
   今天学习了Python装饰器的用法...
   关键词：@decorator, 闭包, 函数式编程
   ```

---

### 🔧 问题5：内存占用过高

**症状**：VectorDB占用内存过大

**优化方案**：

1. **调整配置参数**
   ```bash
   # config.env
   VECTORDB_MAX_MEMORY_MB=300  # 降低内存限制
   VECTORDB_CACHE_SIZE=50      # 减少缓存大小
   ```

2. **分拆大型日记本**
   ```
   将一个大型日记本拆分为多个小的：
   dailynote/小克/  →  dailynote/小克2025Q1/
                     dailynote/小克2025Q2/
   ```

3. **定期清理旧日记**
   ```bash
   # 归档旧日记（移出dailynote目录）
   mkdir archive
   mv dailynote/小克/2024*.txt archive/
   ```

4. **使用懒加载**
   ```
   只有在需要时才加载特定日记本：
   《《日记本》》 # 只有相似度达标才加载
   ```

---

## 📚 延伸阅读

- [VCPToolBox 日记系统详解](DailyNote_User_Guide.md) - 技术详细文档
- [VCPToolBox 快速入门](DailyNote_Quick_Start.md) - 5分钟快速开始
- [VCPToolBox README](../README.md) - 完整项目文档
- [插件开发手册](../README.md#插件开发) - 开发自定义插件

---

## 🎓 最佳实践总结

### ✅ DO - 推荐做法

1. **日记命名**
   - ✅ 使用清晰的角色名作为文件夹名
   - ✅ 日记文件使用日期格式：YYYY.MM.DD.txt
   - ✅ 在日记中包含时间、主题标签

2. **提示词设计**
   - ✅ 明确告知AI何时记录日记
   - ✅ 提供清晰的日记模板
   - ✅ 使用RAG检索而非全文注入（日记多时）
   - ✅ 根据场景选择合适的检索模式

3. **内容质量**
   - ✅ 日记简洁、结构化
   - ✅ 包含可操作的信息
   - ✅ 添加主题标签和关键词
   - ✅ 记录决策的原因，不只是结果

4. **维护管理**
   - ✅ 定期整理和归档
   - ✅ 备份重要日记
   - ✅ 监控向量数据库健康度
   - ✅ 优化语义组配置

### ❌ DON'T - 避免做法

1. **不要**
   - ❌ 日记过于啰嗦（流水账）
   - ❌ 记录临时性、无价值的信息
   - ❌ 在日记文件夹名中使用"日记本"字样
   - ❌ 频繁改变日记格式

2. **不要**
   - ❌ 小日记库使用复杂的RAG配置
   - ❌ 大日记库使用全文注入{{}}
   - ❌ 过度依赖AI自动判断何时记录
   - ❌ 忽视向量数据库的维护

---

## 🎉 成功案例

### 案例1：个人知识管理

**用户**: 程序员，使用AI助手学习新技术

**配置**：
- 日记本：学习日记
- 模式：[[学习日记::Group::Rerank]]
- 语义组：配置了各种技术栈关键词

**效果**：
- ✅ 3个月积累了200+学习笔记
- ✅ 检索准确率>95%
- ✅ 随时复习过去学过的知识
- ✅ AI能根据历史学习进度给建议

---

### 案例2：项目管理

**用户**: 项目经理，用AI追踪多个项目

**配置**：
- 日记本：项目A, 项目B, 公共
- 模式：[[项目A日记::Time]]
- 定期整理：每周用DailyNoteManager生成周报

**效果**：
- ✅ 清晰的项目进展追踪
- ✅ 决策可追溯
- ✅ 跨项目经验共享
- ✅ 自动生成进度报告

---

### 案例3：多AI协作

**团队**: 3个AI Agent协同工作

**配置**：
- 各自独立日记本
- 共享公共知识库
- 使用语义组标注专业领域

**效果**：
- ✅ 专家AI分享专业知识
- ✅ 通用AI学习并应用专家知识
- ✅ 知识在团队中流动
- ✅ 集体智慧不断增长

---

## 📞 获取帮助

**社区支持**：
- GitHub Issues: https://github.com/yuxuhai/VCPToolBox_test/issues
- 文档中心: 项目README.md

**调试工具**：
- Web管理面板：http://localhost:PORT/AdminPanel
- ShowVCP调试模式：ShowVCP=true
- 服务器日志：查看实时运行日志

---

**祝你打造出完美的AI记忆系统！** 🎉🤖📝

---

*文档版本: 1.0*  
*最后更新: 2025-10-13*  
*作者: VCPToolBox Team*
