# 变量系统详解

VCP ToolBox 的变量系统是一个强大而灵活的功能，它允许您在系统提示词中动态地注入各种信息。这个系统是实现 Agent 个性化、感知环境、调用复杂工具链的基础。

变量系统的核心语法是使用双大括号 `{{ }}` 来包裹变量名。当 VCP 处理提示词时，它会自动查找并替换这些占位符为它们的实际值。

## 变量的类型

VCP 中的变量主要分为以下几类：

### 1. 内置动态变量 (Built-in Dynamic Variables)

这些是系统预设的、会自动更新的变量，提供了基础的环境信息。

-   **`{{Date}}`**: 当前日期，格式为 `YYYY-MM-DD`。
-   **`{{Time}}`**: 当前时间，格式为 `HH:MM:SS`。
-   **`{{Today}}`**: 今天的详细日期，包含星期。
-   **`{{Festival}}`**: 当前的节假日信息（如果当天是节假日）。

### 2. 插件注入变量 (Plugin-injected Variables)

一些插件 (特别是静态插件) 会将其获取到的信息注册为变量，供系统提示词使用。

-   **`{{VCPWeatherInfo}}`**: 由 **[天气预报员](./plugins/WeatherReporter.md)** 插件提供，包含详细的实时天气信息。
-   **`{{通用表情包}}`**: 由 **[��情包列表生成器](./plugins/EmojiListGenerator.md)** 插件提供，包含所有可用表情包的文件名列表。

### 3. 自定义变量 (Custom Variables - `Var*`)

这些是您可以在 `config.env` 文件中自由定义的变量，用于注入个性化的信息。它们通常以 `Var` 开头。

-   **`{{VarCity}}`**: 您所在的城市。
-   **`{{VarUser}}`**: 用户的简介。
-   **`{{VarHttpUrl}}`**: VCP 服务的公开访问地址。

**使用方法**:
在 `config.env` 中定义：
```
VarCity=上海
VarUser=一位热爱探索AI的工程师
```
在系统提示词中引用：
```
你好，我是一个AI助手。当前城市是{{VarCity}}，正在为{{VarUser}}服务。
```

### 4. 目标提示词变量 (Target Prompt Variables - `Tar*`)

这些变量同样在 `config.env` 中定义，但它们通常用于构建更复杂的、可复用的提示词片段。它们可以互相引用其他变量。它们以 `Tar` 开头。

**使用方法**:
在 `config.env` 中定义：
```
TarTimeNow="今天是{{Date}},{{Today}}。现在是{{Time}}。"
TarSysPrompt="{{TarTimeNow}}当前地址是{{VarCity}},当前天气是{{VCPWeatherInfo}}。"
```
在 Agent 的配置文件中，您只需要引用 `{{TarSysPrompt}}` 即可包含所有这些信息。

### 5. 模型专属变量 (Model-specific Variables - `Sar*`)

这些���量允许您为特定的 AI 模型定义专属的提示词。这对于优化不同模型的性能非常有用。它们以 `Sar` 开头。

**使用方法**:
在 `config.env` 中定义：
```
SarModel1=gpt-4-turbo,gpt-4o
SarPrompt1="你是一个知识渊博的专家，请使用严谨、专业的语言回答问题。"

SarModel2=claude-3-opus
SarPrompt2="你是一个富有创造力和同理心的伙伴，请使用温暖、鼓励的语言进行交流。"
```
当 VCP 检测到当前使用的模型是 `gpt-4-turbo` 或 `gpt-4o` 时，`{{SarPrompt1}}` 的内容会自动附加到系统提示词中。同理，使用 `claude-3-opus` 时会附加 `{{SarPrompt2}}`。

## 变量的解析流程

当一次对话开始时，VCP 会按照以下顺序解析和替换所有变量：

1.  **加载 Agent 配置文件**: 读取 `Agent/xxx.txt` 中的原始系统提示词。
2.  **替换 `Tar*` 和 `Var*` 变量**: 将所有在 `config.env` 中定义的自定义变量和目标提示词变量替换为其内容。这个过程可能会递归进行（例如 `TarSysPrompt` 引用了 `TarTimeNow`）。
3.  **替换内置动态变量**: 替换 `{{Date}}`, `{{Time}}` 等。
4.  **替换插件注入变量**: 调用相关插件，获取 `{{VCPWeatherInfo}}` 等的值并进行替换。
5.  **处理 `Sar*` 变量**: 判断当前使用的模型，并附加相应的模型专属提示词。
6.  **最终处理**: 将所有插件的详细使用说明（例如 `{{VCPTavilySearch}}` 的长篇描述）替换到最终的系统提示词中。

通过这个强大的变量系统，您可以以极高的灵活性和模块化程度来构建和管理您的 AI Agent，让它们能够感知环境、拥有个性和掌握复杂的工具。
